
<nav class="glass-nav h-20 px-4 py-2 sm:px-7 sm:py-2 fixed top-0 left-0 w-full z-50  border-white/10" 
     [ngClass]="{'transform translate-y-0': isNavbarVisible, 'transform -translate-y-full': !isNavbarVisible}" 
     id="mobile-menu-container">
  <div class="max-w-7xl mx-auto flex items-center justify-between pt-4">
    <!-- Logo -->
    <a [routerLink]="['/']" class="logo-container">
      <div class="flex items-center space-x-2 group">
        <img src="https://res.cloudinary.com/dfpezlzsy/image/upload/v1741318710/evendigo-logo_x8w63l.webp" 
             alt="Logo" class="w-15 h-8 transition-transform duration-300 group-hover:scale-110">
        <span class="text-white text-xl font-semibold tracking-wide group-hover:text-[#00ff66] transition-colors">EvenDigo</span>
      </div>
    </a>

    <!-- Mobile Menu Button -->
    <div class="sm:hidden">
      <button (click)="toggleMobileMenu()" class="mobile-menu-btn relative z-50">
        <div class="hamburger-lines" [ngClass]="{'active': isMobileMenuOpen}">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </button>
    </div>

    <!-- Desktop Navigation - Logged In -->
    <ng-container *ngIf="(user$ | async) as user; else loggedOut">
      <!-- Mobile Menu Overlay -->
      <div class="mobile-menu-overlay" [ngClass]="{'active': isMobileMenuOpen}" (click)="toggleMobileMenu()"></div>
      
      <!-- Mobile Menu -->
      <div class="mobile-menu" [ngClass]="{'active': isMobileMenuOpen}">
        <div class="mobile-menu-content">
          <button (click)="toggleMobileMenu()" class="mobile-close-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
          
          <div class="mobile-user-header">
            <div class="user-avatar" [class]="getInitialColor(user.name)">
              {{ user.name.charAt(0).toUpperCase() }}
            </div>
            <div class="user-info">
              <h3 class="user-name">{{ user?.name }}</h3>
              <p class="user-email">Welcome back!</p>
            </div>
          </div>

          <nav class="mobile-nav-links">
            <a [routerLink]="['/']" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
               (click)="toggleMobileMenu()" class="nav-link">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
              </svg>
              <span>Home</span>
            </a>
            
            <a [routerLink]="['/explore']" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
               (click)="toggleMobileMenu()" class="nav-link">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
              <span>Explore</span>
            </a>
            
            <a [routerLink]="['/dashboard']" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
               (click)="toggleMobileMenu()" class="nav-link">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              <span>Dashboard</span>
            </a>
            
            <a [routerLink]="['/chats']" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
               (click)="toggleMobileMenu()" class="nav-link">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
              <span>Messages</span>
            </a>
            
            <a [routerLink]="['/profile']" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
               (click)="toggleMobileMenu()" class="nav-link">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
              <span>Account</span>
            </a>
          </nav>

          <div class="mobile-logout">
            <button (click)="openConfirmLogout()" class="logout-btn">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
              </svg>
              <span>Logout</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Desktop Navigation - Enhanced -->
      <div class="hidden sm:flex sm:items-center sm:justify-center sm:space-x-6">
        <div class="nav-pill-container">
          <ul class="flex flex-row space-x-1 items-center">
            <li>
              <a [routerLink]="['/']" routerLinkActive="nav-active" [routerLinkActiveOptions]="{exact: true}"
                 class="nav-pill">HOME</a>
            </li>
            <li>
              <a [routerLink]="['/explore']" routerLinkActive="nav-active" [routerLinkActiveOptions]="{exact: true}"
                 class="nav-pill">EXPLORE</a>
            </li>
            <li>
              <a [routerLink]="['/dashboard']" routerLinkActive="nav-active" [routerLinkActiveOptions]="{exact: true}"
                 class="nav-pill">DASHBOARD</a>
            </li>
          </ul>
        </div>
      </div>

      <!-- User Actions - Enhanced -->
      <div class="hidden sm:flex items-center space-x-4">
        <button [routerLink]="'/chats'" class="icon-btn relative">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
          </svg>
          <!-- Optional notification badge -->
          <!-- <span class="notification-badge"></span> -->
        </button>
        
        <div class="relative">
          <button (click)="toggleDropdown($event)" class="user-avatar-btn" [class]="getInitialColor(user.name)">
            {{userInitial$|async}}
          </button>

          <!-- Enhanced Dropdown -->
          <div id="userDropdown" [ngClass]="{'opacity-0 translate-y-[-10px] pointer-events-none': !isDropdownOpen, 
               'opacity-100 translate-y-0': isDropdownOpen}"
               class="dropdown-menu">
            <div class="dropdown-header">
              <div [class]="'user-avatar-small ' + getInitialColor(user.name)">
                {{ user.name.charAt(0).toUpperCase() }}
              </div>
              <div class="user-info-dropdown">
                <span class="user-name-dropdown">{{ user?.name }}</span>
                <span class="user-email-dropdown">{{ user?.email }}</span>
              </div>
            </div>

            <div class="dropdown-divider"></div>

            <a [routerLink]="['/profile']" class="dropdown-item">
              <svg class="dropdown-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
              <span>My Profile</span>
            </a>
            
            <a [routerLink]="['/dashboard']" class="dropdown-item">
              <svg class="dropdown-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              <span>Dashboard</span>
            </a>

            <div class="dropdown-divider"></div>

            <button (click)="openConfirmLogout()" class="dropdown-item logout-item">
              <svg class="dropdown-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
              </svg>
              <span>Logout</span>
            </button>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Desktop Navigation - Logged Out -->
    <ng-template #loggedOut>
      <!-- Mobile Menu Overlay -->
      <div class="mobile-menu-overlay" [ngClass]="{'active': isMobileMenuOpen}" (click)="toggleMobileMenu()"></div>
      
      <!-- Mobile Menu - Logged Out -->
      <div class="mobile-menu logged-out" [ngClass]="{'active': isMobileMenuOpen}">
        <div class="mobile-menu-content">
          <button (click)="toggleMobileMenu()" class="mobile-close-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
          
          <div class="mobile-welcome-header">
            <h3 class="welcome-title">Welcome to EvenDigo</h3>
            <p class="welcome-subtitle">Join our community today</p>
          </div>

          <nav class="mobile-auth-links">
            <a [routerLink]="['/login']" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
               (click)="toggleMobileMenu()" class="auth-link login-link">
              <svg class="auth-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
              </svg>
              <span>Login</span>
            </a>
            
            <a [routerLink]="['/register']" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
               (click)="toggleMobileMenu()" class="auth-link signup-link">
              <svg class="auth-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
              </svg>
              <span>Sign Up</span>
            </a>
          </nav>
        </div>
      </div>

      <!-- Desktop Auth Buttons -->
      <div class="hidden sm:flex sm:items-center sm:justify-center sm:space-x-4">
        <a [routerLink]="['/login']" class="auth-btn-outline">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
          </svg>
          <span>Login</span>
        </a>
        <a [routerLink]="['/register']" class="auth-btn-solid">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
          </svg>
          <span>Get Started</span>
        </a>
      </div>
    </ng-template>
  </div>
</nav>

<!-- Logout Confirmation Modal -->
<div *ngIf="confirmLogoutOpen"
     class="fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm"
     (click)="closeConfirmLogout()">
  <div class="bg-[#121212] rounded-xl shadow-2xl neon-shadow p-7 max-w-sm w-full border border-[#00ff66]/30"
       (click)="$event.stopPropagation()">
    <div class="flex items-center mb-6">
      <svg class="w-6 h-6 text-[#00ff66] mr-2 drop-shadow-neon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
      </svg>
      <span class="text-xl font-bold text-[#00ff66] drop-shadow-neon">Logout Confirmation</span>
    </div>
    <p class="text-gray-200 mb-7 text-base">Are you sure you want to logout?</p>
    <div class="flex justify-between mt-2 gap-3">
      <button class="bg-[#00ff66] text-black px-6 py-2 rounded-lg font-bold hover:bg-[#26ff80] transition focus:outline-none neon-btn-shadow"
              (click)="confirmLogout()">
        Yes, Logout
      </button>
      <button class="bg-[#222] border border-[#00ff66] text-[#00ff66] px-6 py-2 rounded-lg font-bold hover:bg-[#333] hover:text-white transition focus:outline-none"
              (click)="closeConfirmLogout()">
        Cancel
      </button>
    </div>
  </div>
</div>
