<div class="min-h-screen bg-gradient-to-br  text-white pt-10 px-4">
  <div class="max-w-5xl mx-auto">

    @if (user) {
    <!-- User profile card with glassmorphism -->
    <div class="glass-card rounded-3xl shadow-2xl overflow-hidden mb-8 border border-white/10">
      
      <div class="flex flex-col md:flex-row p-6 md:p-8">
        <!-- Profile image section -->
        <div class="flex flex-col items-center mb-6 md:mb-0 md:mr-8">
          <div class="relative group">
            <!-- Glow effect -->
            <div class="absolute -inset-1 bg-gradient-to-r from-[#00ff66] via-[#00cc52] to-[#00ff66] rounded-full opacity-75 group-hover:opacity-100 blur-lg group-hover:blur-xl transition-all duration-500 animate-pulse-slow"></div>
            
            <div class="relative">
              <img [src]="imageError ? defaultImageUrl : (user.profileImg || defaultImageUrl)" 
                   alt="Profile picture"
                   class="h-36 w-36 rounded-full object-cover border-4 border-[#00ff66]/50 group-hover:border-[#00ff66] transition-all duration-300 shadow-xl ring-2 ring-[#00ff66]/20" />

              <button (click)="openFileSelector()"
                class="absolute bottom-2 right-2 bg-gradient-to-br from-[#00ff66] to-[#00cc52] text-black h-10 w-10 rounded-full flex items-center justify-center hover:scale-110 transition-all duration-300 shadow-neon group/btn">
                <i class="fas fa-camera group-hover/btn:scale-110 transition-transform"></i>
              </button>
              <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" class="hidden" />
            </div>
          </div>

          <div class="mt-6 text-center">
            <h3 class="font-bold text-2xl mb-2 bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent">{{user.name}}</h3>
            
            <!-- Verification badge -->
            <div class="flex flex-col items-center justify-center space-y-3 mt-4">
              @if (verificationData.status=='Verified') {
                <div class="verification-badge verified">
                  <i class="fas fa-check-circle mr-2"></i>
                  <span>Verified</span>
                </div>
              } @else if (verificationData.status=='Pending') {
                <div class="verification-badge pending">
                  <i class="fas fa-clock mr-2"></i>
                  <span>Pending</span>
                </div>
              } @else if (verificationData.status=='Rejected') {
                <div class="verification-badge rejected">
                  <i class="fas fa-times-circle mr-2"></i>
                  <span>Rejected</span>
                </div>
              } @else {
                @if (user.name && user.email && user.phone && user.bio && user.location && user.dateOfBirth) {
                  <button (click)="sendVerificationRequest()"
                    class="verification-btn">
                    <i class="fas fa-shield-alt mr-2"></i>
                    Verify Account
                  </button>
                  <div class="glass-warning">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <span>Click to verify your account</span>
                  </div>
                } @else {
                  <div class="flex flex-col items-center space-y-3">
                    <div class="verification-badge incomplete">
                      <i class="fas fa-user-slash mr-2"></i>
                      <span>Incomplete Profile</span>
                    </div>
                    <div class="glass-warning">
                      <i class="fas fa-exclamation-triangle mr-2"></i>
                      <span>Complete your profile to request verification</span>
                    </div>
                  </div>
                }
              }
            </div>
          </div>

          <!-- Achievement Badges -->
          <div class="mt-8 w-full">
            <h4 class="text-sm font-semibold text-gray-400 mb-4 text-center flex items-center justify-center gap-2">
              <i class="fas fa-trophy text-[#00ff66]"></i>
              Achievement Badges
            </h4>
            <div class="flex flex-wrap justify-center gap-4">
              @for (badge of achievements; track $index) {
                @if(badge.isActive){
                  <div class="badge-container group">
                    <div class="badge-wrapper {{getBadgeColorClass(badge, $index)}}">
                      <i [class]="badge.icon+' text-xl '+getBadgeIconColor(badge, $index)"></i>
                    </div>
                    
                    <div class="badge-tooltip">
                      <span class="font-bold text-sm">{{badge.title}}</span>
                      <div class="tooltip-arrow"></div>
                    </div>
                  </div>
                }
              }
            </div>
          </div>
        </div>

        <!-- User Information Section -->
        <div class="flex-1">
          <div class="glass-info-card rounded-2xl p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="info-item group">
                <p class="info-label">
                  <i class="fas fa-envelope info-icon text-blue-400"></i>
                  Email
                </p>
                <p class="info-value">{{user.email}}</p>
              </div>
              
              <div class="info-item group">
                <p class="info-label">
                  <i class="fas fa-phone info-icon text-green-400"></i>
                  Phone
                </p>
                <p class="info-value">{{user.phone || 'Not provided'}}</p>
              </div>
              
              <div class="info-item group">
                <p class="info-label">
                  <i class="fas fa-birthday-cake info-icon text-pink-400"></i>
                  Date Of Birth
                </p>
                <p class="info-value">{{user.dateOfBirth | date:'mediumDate'}}</p>
              </div>
              
              <div class="info-item group">
                <p class="info-label">
                  <i class="fas fa-map-marker-alt info-icon text-red-400"></i>
                  Location
                </p>
                <p class="info-value">{{user.location || 'Not provided'}}</p>
              </div>
              
              <div class="info-item group">
                <p class="info-label">
                  <i class="fas fa-venus-mars info-icon text-purple-400"></i>
                  Gender
                </p>
                <p class="info-value">{{user.gender || 'Not provided'}}</p>
              </div>
              
              <div class="info-item group md:col-span-2">
                <p class="info-label">
                  <i class="fas fa-info-circle info-icon text-yellow-400"></i>
                  Bio
                </p>
                <p class="info-value">{{user.bio || 'Not provided'}}</p>
              </div>
            </div>
          </div>

          <!-- Edit button -->
          @if (!editMode) {
            <button (click)="editMode=true" class="action-btn primary w-full">
              <i class="fas fa-edit mr-2"></i>
              Update Your Information
            </button>
          }
        </div>
      </div>
      
      <!-- Change Password Section -->
      <div class="glass-footer p-6 border-t border-white/10">
        <div class="flex justify-end">
          <button (click)="openChangePasswordDialog()" class="action-btn secondary">
            <i class="fa fa-lock mr-2"></i>
            Change Password
          </button>
        </div>
      </div>
    </div>
    }

    <!-- Edit Profile Dialog -->
    <p-dialog header="Edit Profile" [(visible)]="editMode" [style]="{ width: '40rem' }" [modal]="true"
      styleClass="custom-dialog">
      <div class="dialog-content">
        <span class="dialog-subtitle">Update your personal information to complete your profile</span>
        
        <form [formGroup]="userForm" (ngSubmit)="updateProfile()">
          <div class="form-grid">
            <!-- Name Field -->
            <div class="form-field">
              <label for="username" class="form-label">
                <i class="fas fa-user mr-2 text-[#00ff66]"></i>
                Name
              </label>
              <input pInputText id="username" class="form-input" formControlName="name" 
                     placeholder="Enter your name"/>
              <div class="form-errors">
                @if (userForm.get('name')?.invalid && (userForm.get('name')?.dirty || userForm.get('name')?.touched)) {
                  @if (hasError('name', 'required')) {
                    <div class="error-message"><i class="fas fa-exclamation-circle mr-1"></i> Name is required</div>
                  }
                  @if (hasError('name', 'minlength')) {
                    <div class="error-message"><i class="fas fa-exclamation-circle mr-1"></i> Name must be at least 3 characters</div>
                  }
                  @if (hasError('name', 'alphabetsOnly')) {
                    <div class="error-message"><i class="fas fa-exclamation-circle mr-1"></i> Name should contain only alphabets</div>
                  }
                }
              </div>
            </div>

            <!-- Phone Field -->
            <div class="form-field">
              <label for="phone" class="form-label">
                <i class="fas fa-phone mr-2 text-[#00ff66]"></i>
                Phone
              </label>
              <input pInputText id="phone" class="form-input" formControlName="phone"
                     placeholder="Enter your phone number"/>
              <div class="form-errors">
                @if (userForm.get('phone')?.invalid && (userForm.get('phone')?.dirty || userForm.get('phone')?.touched)) {
                  @if (hasError('phone', 'required')) {
                    <div class="error-message"><i class="fas fa-exclamation-circle mr-1"></i> Phone number is required</div>
                  }
                  @if (hasError('phone', 'invalidMobile')) {
                    <div class="error-message"><i class="fas fa-exclamation-circle mr-1"></i> Please enter a valid mobile number</div>
                  }
                }
              </div>
            </div>

            <!-- Location Field -->
            <div class="form-field">
              <label for="location" class="form-label">
                <i class="fas fa-map-marker-alt mr-2 text-[#00ff66]"></i>
                Location
              </label>
              <p-autoComplete id="location" [suggestions]="indianCities" (completeMethod)="filterCities($event)"
                [dropdown]="true" formControlName="location" [minLength]="1" placeholder="Select your city"
                styleClass="w-full" inputStyleClass="form-input w-full"></p-autoComplete>
              <div class="form-errors">
                @if (userForm.get('location')?.invalid && (userForm.get('location')?.dirty || userForm.get('location')?.touched)) {
                  @if (hasError('location', 'required')) {
                    <div class="error-message"><i class="fas fa-exclamation-circle mr-1"></i> Location is required</div>
                  }
                }
              </div>
            </div>

            <!-- Bio Field -->
            <div class="form-field">
              <label for="bio" class="form-label">
                <i class="fas fa-comment-alt mr-2 text-[#00ff66]"></i>
                Bio
              </label>
              <textarea pInputText id="bio" rows="3" class="form-input" formControlName="bio"
                        placeholder="Tell us about yourself"></textarea>
              <div class="form-errors">
                @if (userForm.get('bio')?.invalid && (userForm.get('bio')?.dirty || userForm.get('bio')?.touched)) {
                  @if (hasError('bio', 'minlength')) {
                    <div class="error-message"><i class="fas fa-exclamation-circle mr-1"></i> Bio must be at least 3 characters</div>
                  }
                }
              </div>
            </div>

            <!-- Gender Field -->
            <div class="form-field">
              <label for="gender" class="form-label">
                <i class="fas fa-venus-mars mr-2 text-[#00ff66]"></i>
                Gender
              </label>
              <select id="gender" class="form-select" formControlName="gender">
                <option value="" disabled>Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
              <div class="form-errors">
                @if (userForm.get('gender')?.invalid && (userForm.get('gender')?.dirty || userForm.get('gender')?.touched)) {
                  @if (hasError('gender', 'required')) {
                    <div class="error-message"><i class="fas fa-exclamation-circle mr-1"></i> Gender is required</div>
                  }
                }
              </div>
            </div>

            <!-- Date of Birth Field -->
            <div class="form-field">
              <label for="dateofbirth" class="form-label">
                <i class="fas fa-calendar mr-2 text-[#00ff66]"></i>
                Date Of Birth
              </label>
              <p-datePicker id="dateofbirth" formControlName="dateOfBirth" [showIcon]="false" 
                dateFormat="dd/mm/yy" [maxDate]="maxDate" [showButtonBar]="true" 
                placeholder="Select Date" [style]="{'width':'100%'}"
                inputStyleClass="form-input w-full" styleClass="w-full" appendTo="body"></p-datePicker>
              <div class="form-errors">
                @if (userForm.get('dateOfBirth')?.invalid && (userForm.get('dateOfBirth')?.dirty || userForm.get('dateOfBirth')?.touched)) {
                  @if (hasError('dateOfBirth', 'required')) {
                    <div class="error-message"><i class="fas fa-exclamation-circle mr-1"></i> Date of birth is required</div>
                  }
                }
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" (click)="cancelEdit()" class="action-btn secondary">
              <i class="fas fa-times mr-2"></i>
              Cancel
            </button>
            <button type="submit" [disabled]="isLoading || userForm.invalid" class="action-btn primary">
              <i class="fas fa-save mr-2"></i>
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </p-dialog>

    <!-- Change Password Dialog -->
    <p-dialog header="Change Password" [(visible)]="showChangePasswordDialog" 
      [style]="{ width: '40rem' }" [modal]="true" styleClass="custom-dialog">
      <div class="dialog-content">
        <span class="dialog-subtitle">Update your password to secure your account</span>
        
        <form [formGroup]="changePasswordForm" (ngSubmit)="submitPasswordChange()">
          <div class="form-grid">
            <!-- Current Password -->
            <div class="form-field">
              <label for="currentPassword" class="form-label">
                <i class="fas fa-lock mr-2 text-[#00ff66]"></i>
                Current Password
              </label>
              <div class="password-input-wrapper">
                <input pInputText id="currentPassword" [type]="showCurrentPassword ? 'text' : 'password'"
                  class="form-input pr-12" formControlName="currentPassword"
                  placeholder="Enter current password"/>
                <button type="button" class="password-toggle" (click)="showCurrentPassword = !showCurrentPassword">
                  <i class="fas" [ngClass]="showCurrentPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                </button>
              </div>
              <div class="form-errors">
                <div *ngIf="changePasswordForm.get('currentPassword')?.invalid && 
                          (changePasswordForm.get('currentPassword')?.dirty || 
                          changePasswordForm.get('currentPassword')?.touched)">
                  <div *ngIf="hasPasswordError('currentPassword', 'required')" class="error-message">
                    <i class="fas fa-exclamation-circle mr-1"></i> Current password is required
                  </div>
                </div>
              </div>
            </div>
            
            <!-- New Password -->
            <div class="form-field">
              <label for="newPassword" class="form-label">
                <i class="fas fa-key mr-2 text-[#00ff66]"></i>
                New Password
              </label>
              <div class="password-input-wrapper">
                <input pInputText id="newPassword" [type]="showNewPassword ? 'text' : 'password'"
                  class="form-input pr-12" formControlName="newPassword"
                  placeholder="Enter new password"/>
                <button type="button" class="password-toggle" (click)="showNewPassword = !showNewPassword">
                  <i class="fas" [ngClass]="showNewPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                </button>
              </div>
              <div class="form-errors">
                <div *ngIf="changePasswordForm.get('newPassword')?.invalid && 
                          (changePasswordForm.get('newPassword')?.dirty || 
                          changePasswordForm.get('newPassword')?.touched)">
                  <div *ngIf="hasPasswordError('newPassword', 'required')" class="error-message">
                    <i class="fas fa-exclamation-circle mr-1"></i> New password is required
                  </div>
                  <div *ngIf="hasPasswordError('newPassword', 'strongPassword')" class="error-message">
                    <i class="fas fa-exclamation-circle mr-1"></i> Password must be at least 8 characters
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Confirm Password -->
            <div class="form-field">
              <label for="confirmPassword" class="form-label">
                <i class="fas fa-check-circle mr-2 text-[#00ff66]"></i>
                Confirm Password
              </label>
              <div class="password-input-wrapper">
                <input pInputText id="confirmPassword" [type]="showConfirmPassword ? 'text' : 'password'"
                  class="form-input pr-12" formControlName="confirmPassword"
                  placeholder="Confirm new password"/>
                <button type="button" class="password-toggle" (click)="showConfirmPassword = !showConfirmPassword">
                  <i class="fas" [ngClass]="showConfirmPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                </button>
              </div>
              <div class="form-errors">
                <div *ngIf="changePasswordForm.get('confirmPassword')?.invalid && 
                          (changePasswordForm.get('confirmPassword')?.dirty || 
                          changePasswordForm.get('confirmPassword')?.touched)">
                  <div *ngIf="hasPasswordError('confirmPassword', 'required')" class="error-message">
                    <i class="fas fa-exclamation-circle mr-1"></i> Confirm password is required
                  </div>
                </div>
                <div *ngIf="changePasswordForm.hasError('passwordMismatch') && 
                          changePasswordForm.get('confirmPassword')?.touched" class="error-message">
                  <i class="fas fa-exclamation-circle mr-1"></i> Passwords do not match
                </div>
              </div>
            </div>
          </div>

          <!-- Password Strength Indicator -->
          <div class="password-strength" *ngIf="changePasswordForm.get('newPassword')?.value">
            <div class="strength-label">Password Strength:</div>
            <div class="strength-bar-container">
              <div class="strength-bar"
                [ngClass]="{'weak': changePasswordForm.get('newPassword')?.value.length < 8,
                          'medium': changePasswordForm.get('newPassword')?.value.length >= 8 && changePasswordForm.get('newPassword')?.hasError('strongPassword'),
                          'strong': !changePasswordForm.get('newPassword')?.hasError('strongPassword') && changePasswordForm.get('newPassword')?.value.length >= 8}"
              ></div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" (click)="closeChangePasswordDialog()" class="action-btn secondary">
              <i class="fas fa-times mr-2"></i>
              Cancel
            </button>
            <button type="submit" [disabled]="isLoading || changePasswordForm.invalid" class="action-btn primary">
              <i class="fas fa-save mr-2"></i>
              Change Password
            </button>
          </div>
        </form>
      </div>
    </p-dialog>
  </div>
</div>
