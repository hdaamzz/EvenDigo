<div @fade 
     class="fixed inset-0 z-50 flex items-start justify-center backdrop-blur-sm overflow-y-auto p-0 lg:items-center lg:p-4">
  <div
    #modalRef
    @modal
    class="bg-gradient-to-br from-black to-black text-white w-full overflow-hidden flex flex-col shadow-2xl shadow-[#00ff66]/20 border-0 m-0 min-h-screen 
           lg:max-w-4xl lg:rounded-2xl lg:max-h-[95vh] lg:my-4 lg:border lg:border-[#00ff66]/20 lg:min-h-[600px]"
  >
    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex items-center justify-center h-64 w-full">
      <div class="relative">
        <div class="animate-spin rounded-full h-12 w-12 border-4 border-gray-600 border-t-[#00ff66]"></div>
        <div class="absolute inset-0 rounded-full border-4 border-[#00ff66]/20"></div>
      </div>
    </div>

    <!-- Content Layout -->
    <div *ngIf="!isLoading && eventData" 
         class="flex flex-col h-auto min-h-screen lg:flex-row lg:h-full lg:min-h-[600px] lg:max-h-[95vh]">
      
      <!-- Left Panel - Event Info -->
      <div class="w-full bg-gradient-to-br from-black to-black flex flex-col relative overflow-hidden 
                  lg:w-3/5">
        
        <!-- Hero Image Section -->
        <div class="relative w-full h-48 overflow-hidden flex-shrink-0 group 
                    sm:h-56 lg:h-80">
          <img
            [src]="eventData.promotionalImage"
            [alt]="eventData.eventTitle"
            class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
            loading="lazy"
          />
          <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
          
          <!-- Close Button -->
          <button
            (click)="handleClose()"
            class="absolute top-4 right-4 w-12 h-12 rounded-full bg-black/70 backdrop-blur-md flex items-center justify-center hover:bg-[#00ff66]/20 hover:border-[#00ff66] border border-transparent transition-all duration-300 z-10 group touch-target
                   lg:w-10 lg:h-10"
            aria-label="Close modal"
          >
            <lucide-icon [name]="X" [size]="20" class="text-white group-hover:text-[#00ff66] transition-colors lg:!w-5 lg:!h-5"></lucide-icon>
          </button>
        </div>

        <!-- Scrollable Content Area -->
        <div class="flex-1 overflow-y-visible lg:overflow-y-auto custom-scrollbar">
          <div class="p-4 space-y-4 lg:p-6 lg:space-y-6">
            
            <!-- Title and Category -->
            <div>
              <h1 class="text-2xl font-bold mb-4 text-white leading-tight bg-gradient-to-r from-white via-gray-100 to-gray-300 bg-clip-text text-transparent
                         sm:text-3xl lg:text-3xl lg:mb-4">
                {{ eventData.eventTitle }}
              </h1>
              <div class="flex items-center gap-3 mb-3">
                <span class="px-3 py-1 bg-[#00ff66]/10 border border-[#00ff66]/30 rounded-full text-xs font-medium text-[#00ff66]">
                  {{eventData.eventType}}
                </span>
              </div>
            </div>

            <!-- Event Meta Info -->
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:gap-4">
              <div class="flex items-center gap-3 p-3 rounded-xl bg-[#1a1a1a] border border-gray-800">
                <div class="w-10 h-10 rounded-lg bg-[#00ff66]/10 flex items-center justify-center lg:w-10 lg:h-10">
                  <lucide-icon [name]="Calendar" [size]="18" class="text-[#00ff66] lg:!w-5 lg:!h-5"></lucide-icon>
                </div>
                <div>
                  <p class="text-xs text-gray-400 uppercase tracking-wider">Date & Time</p>
                  <p class="text-sm font-medium text-white">{{ getFormattedDate(eventData.startDate) }}</p>
                  <p class="text-xs text-gray-300">{{ getFormattedTime(eventData.startTime) }}</p>
                </div>
              </div>

              <div class="flex items-center gap-3 p-3 rounded-xl bg-[#1a1a1a] border border-gray-800">
                <div class="w-10 h-10 rounded-lg bg-[#00ff66]/10 flex items-center justify-center lg:w-10 lg:h-10">
                  <lucide-icon [name]="Calendar" [size]="18" class="text-[#00ff66] lg:!w-5 lg:!h-5"></lucide-icon>
                </div>
                <div>
                  <p class="text-xs text-gray-400 uppercase tracking-wider">END DATE</p>
                  <p class="text-sm font-medium text-white">{{ getFormattedDate(eventData.endingDate) }}</p>
                </div>
              </div>

              <div class="flex items-center gap-3 p-3 rounded-xl bg-[#1a1a1a] border border-gray-800">
                <div class="w-10 h-10 rounded-lg bg-[#00ff66]/10 flex items-center justify-center lg:w-10 lg:h-10">
                  <lucide-icon [name]="MapPin" [size]="18" class="text-[#00ff66] lg:!w-5 lg:!h-5"></lucide-icon>
                </div>
                <div>
                  <p class="text-xs text-gray-400 uppercase tracking-wider">Location</p>
                  <p class="text-sm font-medium text-white">{{ eventData.city }}</p>
                  <p class="text-xs text-gray-300">{{ eventData.venue || 'Venue TBA' }}</p>
                </div>
              </div>
            </div>

            <!-- About Event -->
            <div class="space-y-3">
              <h3 class="text-lg font-semibold text-white flex items-center gap-2 lg:text-lg">
                <div class="w-1 h-6 bg-[#00ff66] rounded-full lg:h-6"></div>
                About this event
              </h3>
              <div class="bg-[#1a1a1a] rounded-xl p-3 border border-gray-800 lg:p-4">
                <p class="text-gray-300 text-sm leading-relaxed" [class.line-clamp-3]="!showFullDescription" [class.lg:line-clamp-4]="!showFullDescription">
                  {{ eventData.eventDescription }}
                </p>
                <button 
                  *ngIf="eventData.eventDescription.length > 150"
                  (click)="showFullDescription = !showFullDescription"
                  class="text-[#00ff66] text-sm mt-2 hover:underline transition-colors min-h-[48px] lg:min-h-0"
                >
                  {{ showFullDescription ? 'Show less' : 'Read more' }}
                </button>
              </div>
            </div>

            <!-- Event Details (Collapsible on Mobile) -->
            <div class="space-y-4">
              <button 
                class="w-full text-left lg:cursor-default"
                (click)="showEventDetails = !showEventDetails"
              >
                <h3 class="text-lg font-semibold text-white flex items-center gap-2 lg:text-lg">
                  <div class="w-1 h-6 bg-[#00ff66] rounded-full lg:h-6"></div>
                  Event Details
                  <!-- Mobile toggle indicator -->
                  <lucide-icon 
                    [name]="showEventDetails ? 'ChevronUp' : 'ChevronDown'" 
                    [size]="16" 
                    class="text-[#00ff66] ml-auto transition-transform lg:hidden"
                  ></lucide-icon>
                </h3>
              </button>
              
              <!-- Expandable content -->
              <div class="space-y-3" 
                   [class.hidden]="!showEventDetails" 
                   [class.lg:block]="true">
                <!-- What's Included -->
                <div class="space-y-3">
                  <h4 class="text-base font-medium text-white lg:text-md">What's Included</h4>
                  <div class="grid grid-cols-1 gap-2">
                    <div class="flex items-center gap-3 p-3 bg-[#1a1a1a] rounded-lg border border-gray-800 lg:p-3">
                      <div class="w-2 h-2 bg-[#00ff66] rounded-full flex-shrink-0"></div>
                      <span class="text-sm text-gray-300">Live performance</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-[#1a1a1a] rounded-lg border border-gray-800 lg:p-3">
                      <div class="w-2 h-2 bg-[#00ff66] rounded-full flex-shrink-0"></div>
                      <span class="text-sm text-gray-300">Professional sound system</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-[#1a1a1a] rounded-lg border border-gray-800 lg:p-3">
                      <div class="w-2 h-2 bg-[#00ff66] rounded-full flex-shrink-0"></div>
                      <span class="text-sm text-gray-300">Refreshments available</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-[#1a1a1a] rounded-lg border border-gray-800 lg:p-3">
                      <div class="w-2 h-2 bg-[#00ff66] rounded-full flex-shrink-0"></div>
                      <span class="text-sm text-gray-300">Photo opportunities</span>
                    </div>
                  </div>
                </div>

                <!-- Important Information -->
                <div class="space-y-3">
                  <h4 class="text-base font-medium text-white lg:text-md">Important Information</h4>
                  <div class="bg-[#1a1a1a] rounded-xl p-3 border border-gray-800 lg:p-4">
                    <ul class="space-y-2 text-sm text-gray-300">
                      <li class="flex items-start gap-2">
                        <span class="text-[#00ff66] mt-1 flex-shrink-0">•</span>
                        <span>Please arrive 30 minutes before the event starts</span>
                      </li>
                      <li class="flex items-start gap-2">
                        <span class="text-[#00ff66] mt-1 flex-shrink-0">•</span>
                        <span>Valid ID required for entry</span>
                      </li>
                      <li class="flex items-start gap-2">
                        <span class="text-[#00ff66] mt-1 flex-shrink-0">•</span>
                        <span>No outside food or beverages allowed</span>
                      </li>
                      <li class="flex items-start gap-2">
                        <span class="text-[#00ff66] mt-1 flex-shrink-0">•</span>
                        <span>Refund policy: 48 hours before event</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- Event Organizer -->
            <div class="border-t border-gray-800 pt-4 mt-4 lg:pt-6 lg:mt-6">
              <h3 class="text-lg font-semibold text-white flex items-center gap-2 mb-4 lg:text-lg lg:mb-4">
                <div class="w-1 h-6 bg-[#00ff66] rounded-full lg:h-6"></div>
                Event Organizer
              </h3>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-4 min-w-0 flex-1 lg:gap-4">
                  <div class="relative">
                    <img
                      [src]="eventData.user_id.profileImg"
                      [alt]="eventData.user_id.name"
                      class="w-12 h-12 rounded-xl object-cover border-2 border-[#00ff66]/20 lg:w-12 lg:h-12"
                    />
                    <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-[#00ff66] rounded-full border-2 border-black lg:w-4 lg:h-4"></div>
                  </div>
                  <div class="min-w-0 flex-1">
                    <p class="font-semibold text-white text-base lg:text-base">{{ eventData.user_id.name }}</p>
                    <p class="text-sm text-gray-400">Event Organizer</p>
                    <p class="text-sm text-[#00ff66] truncate">{{ eventData.user_id.email }}</p>
                  </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-3 flex-shrink-0">
                  <button
                    (click)="shareEvent()"
                    class="w-12 h-12 rounded-xl flex items-center justify-center bg-[#1a1a1a] hover:bg-[#00ff66]/10 hover:border-[#00ff66]/30 border border-gray-700 transition-all duration-300 group min-h-[48px]
                           lg:w-10 lg:h-10 lg:min-h-0"
                    title="Share Event"
                  >
                    <lucide-icon [name]="Share2" [size]="16" class="text-gray-300 group-hover:text-[#00ff66] transition-colors lg:!w-4 lg:!h-4"></lucide-icon>
                  </button>

                  <button
                    (click)="handleChat(eventData.user_id._id)"
                    class="w-12 h-12 rounded-xl flex items-center justify-center bg-[#00ff66]/10 hover:bg-[#00ff66]/20 border border-[#00ff66]/30 hover:border-[#00ff66]/50 transition-all duration-300 group min-h-[48px]
                           lg:w-10 lg:h-10 lg:min-h-0"
                    title="Chat with Organizer"
                  >
                    <lucide-icon [name]="MessageCircle" [size]="16" class="text-[#00ff66] group-hover:scale-110 transition-transform lg:!w-4 lg:!h-4"></lucide-icon>
                  </button>
                </div>
              </div>
            </div>

            <!-- Bottom padding for scroll -->
            <div class="h-4 lg:h-4"></div>
          </div>
        </div>
      </div>

      <!-- Right Panel - Ticket Selection -->
      <div class="w-full flex flex-col bg-gradient-to-br from-black to-black border-t border-gray-800 
                  lg:w-2/5 lg:border-t-0 lg:border-l">
        
        <!-- Header -->
        <div class="p-4 border-b border-gray-800 bg-gradient-to-r from-black to-black lg:p-6">
          <div class="flex items-center justify-between mb-4 lg:mb-4">
            <h2 class="text-xl font-bold text-white flex items-center gap-3 lg:text-xl lg:gap-3">
              <div class="w-2 h-8 bg-[#00ff66] rounded-full lg:h-8"></div>
              Select Tickets
            </h2>
            <div class="text-right">
              <p class="text-xs text-gray-400">Max {{ maxTicketsPerUser }} per person</p>
              <p class="text-sm font-medium text-[#00ff66]">{{ totalTickets }}/{{ maxTicketsPerUser }}</p>
            </div>
          </div>

          <!-- Progress Bar -->
          <div class="w-full bg-gray-800 rounded-full h-2 overflow-hidden">
            <div 
              class="h-full bg-gradient-to-r from-[#00ff66] to-[#00ff66]/80 transition-all duration-500"
              [style.width.%]="(totalTickets / maxTicketsPerUser) * 100"
            ></div>
          </div>
        </div>

        <!-- Tickets List -->
        <div class="flex-1 overflow-y-visible lg:overflow-y-auto custom-scrollbar">
          <div class="p-4 space-y-4 lg:p-6 lg:space-y-4">
            <div
              *ngFor="let ticket of eventData.tickets; let i = index; trackBy: trackByTicketType"
              class="group relative overflow-hidden rounded-xl bg-gradient-to-br from-[#1a1a1a] to-[#1a1a1a] border border-gray-700/50 hover:border-[#00ff66]/30 transition-all duration-300 hover:shadow-lg hover:shadow-[#00ff66]/10
                     lg:rounded-2xl"
            >
              <!-- Glow effect -->
              <div class="absolute inset-0 bg-gradient-to-r from-[#00ff66]/0 via-[#00ff66]/5 to-[#00ff66]/0 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
              
              <div class="relative p-4 lg:p-5">
                <!-- Ticket Header -->
                <div class="flex justify-between items-start mb-4 lg:mb-4">
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-2">
                      <h3 class="font-bold text-white text-lg truncate lg:text-lg">{{ ticket.type | titlecase }}</h3>
                      <div class="px-3 py-1 bg-[#00ff66]/10 border border-[#00ff66]/20 rounded-full flex-shrink-0">
                        <span class="text-xs font-medium text-[#00ff66]">{{ getRemainingTickets(ticket) }} left</span>
                      </div>
                    </div>
                    <p class="text-gray-400 text-sm lg:text-sm">{{ getTicketDescription(ticket.type) }}</p>
                  </div>
                  <div class="text-right ml-4">
                    <div class="text-2xl font-bold text-white lg:text-2xl">₹{{ ticket.price | number }}</div>
                    <div class="text-xs text-gray-400">per ticket</div>
                  </div>
                </div>

                <!-- Ticket Selection Controls -->
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <div class="w-2 h-2 bg-[#00ff66] rounded-full animate-pulse" *ngIf="ticketCounts[ticket.type.toLowerCase()] > 0"></div>
                    <span class="text-sm text-gray-400">
                      Selected: <span class="text-[#00ff66] font-medium">{{ ticketCounts[ticket.type.toLowerCase()] || 0 }}</span>
                    </span>
                  </div>
                  
                  <div class="flex items-center gap-3 bg-black/30 rounded-xl p-2 border border-gray-700 lg:gap-3">
                    <button
                      (click)="decrementTicket(i)"
                      class="w-10 h-10 rounded-lg bg-gray-700 hover:bg-gray-600 flex items-center justify-center text-white transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed hover:scale-105 active:scale-95 min-h-[48px]
                             lg:w-9 lg:h-9 lg:min-h-0"
                      [disabled]="ticketCounts[ticket.type.toLowerCase()] === 0"
                    >
                      <span class="text-lg font-bold lg:text-lg">−</span>
                    </button>
                    
                    <div class="w-12 h-10 flex items-center justify-center bg-[#00ff66]/10 border border-[#00ff66]/20 rounded-lg lg:w-12 lg:h-9">
                      <span class="text-[#00ff66] font-bold text-lg lg:text-lg">
                        {{ ticketCounts[ticket.type.toLowerCase()] || 0 }}
                      </span>
                    </div>
                    
                    <button
                      (click)="incrementTicket(i)"
                      class="w-10 h-10 rounded-lg bg-[#00ff66]/10 hover:bg-[#00ff66]/20 border border-[#00ff66]/20 hover:border-[#00ff66]/40 flex items-center justify-center text-[#00ff66] transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed hover:scale-105 active:scale-95 min-h-[48px]
                             lg:w-9 lg:h-9 lg:min-h-0"
                      [disabled]="totalTickets >= maxTicketsPerUser || ticketCounts[ticket.type.toLowerCase()] >= ticket.quantity"
                    >
                      <span class="text-lg font-bold lg:text-lg">+</span>
                    </button>
                  </div>
                </div>

                <!-- Ticket Benefits -->
                <div *ngIf="getTicketBenefits(ticket.type).length > 0" class="mt-4 pt-4 border-t border-gray-700/50 lg:mt-4 lg:pt-4">
                  <div class="flex flex-wrap gap-2 lg:gap-2">
                    <span 
                      *ngFor="let benefit of getTicketBenefits(ticket.type)" 
                      class="px-3 py-1 bg-gray-800/50 border border-gray-600 rounded-md text-xs text-gray-300"
                    >
                      {{ benefit }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Checkout Section -->
        <div class="bg-gradient-to-r from-black to-black border-t border-gray-800 p-4 flex-shrink-0 lg:p-6">
          <div class="space-y-4 lg:space-y-4">
            <!-- Total Summary -->
            <div class="flex justify-between items-center p-4 bg-[#1a1a1a] rounded-xl border border-gray-800 lg:p-4">
              <div>
                <p class="text-gray-400 text-sm">Total Amount</p>
                <p class="text-2xl font-bold text-white lg:text-2xl">
                  {{ totalTickets === 0 ? 'Select tickets' : '₹' + calculateTotal().toLocaleString('en-IN') }}
                </p>
                <p *ngIf="totalTickets > 0" class="text-sm text-[#00ff66] mt-1">
                  {{ totalTickets }} ticket{{ totalTickets !== 1 ? 's' : '' }} • 
                  <span class="text-gray-400">Instant confirmation</span>
                </p>
              </div>
              <div *ngIf="totalTickets > 0" class="text-right">
                <div class="w-16 h-16 rounded-full bg-[#00ff66]/10 border-4 border-[#00ff66]/20 flex items-center justify-center lg:w-16 lg:h-16">
                  <lucide-icon [name]="Users" [size]="20" class="text-[#00ff66] lg:!w-5 lg:!h-5"></lucide-icon>
                </div>
              </div>
            </div>

            <!-- Purchase Button -->
            <button
              (click)="proceedToCheckout()"
              [disabled]="totalTickets === 0"
              class="w-full relative overflow-hidden bg-gradient-to-r from-[#00ff66] to-[#00ff66]/80 hover:from-[#00ff66]/90 hover:to-[#00ff66]/70 text-black font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none shadow-lg shadow-[#00ff66]/25 group min-h-[48px]
                     lg:py-4 lg:px-6 lg:min-h-0"
            >
              <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 -skew-x-12 translate-x-[-200%] group-hover:translate-x-[200%] transition-transform duration-1000"></div>
              <div class="relative flex items-center justify-center gap-3 lg:gap-3">
                <span class="text-lg lg:text-lg">
                  {{ totalTickets === 0 ? 'Select Tickets First' : 'Purchase Tickets' }}
                </span>
                <lucide-icon *ngIf="totalTickets > 0" [name]="ArrowRight" [size]="20" class="group-hover:translate-x-1 transition-transform lg:!w-5 lg:!h-5"></lucide-icon>
              </div>
            </button>

            <!-- Security Note -->
            <div class="flex items-center justify-center gap-2 text-xs text-gray-500">
              <lucide-icon [name]="Shield" [size]="14"></lucide-icon>
              <span>Secure payment powered by Stripe</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
